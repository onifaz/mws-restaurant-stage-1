{"version":3,"sources":["main.js"],"names":["restaurants","neighborhoods","cuisines","mainmap","markers","document","addEventListener","event","fetchNeighborhoods","fetchCuisines","updateRestaurants","lazyload","DBHelper","error","console","self","fillNeighborhoodsHTML","select","getElementById","forEach","neighborhood","option","createElement","innerHTML","value","append","fillCuisinesHTML","cuisine","window","initMap","google","maps","Map","zoom","center","lat","lng","scrollwheel","addMarkersToMap","addGmapMain","setAttribute","script","src","type","body","appendChild","cSelect","nSelect","cIndex","selectedIndex","nIndex","fetchRestaurantByCuisineAndNeighborhood","resetRestaurants","fillRestaurantsHTML","m","setMap","ul","restaurant","createRestaurantHTML","li","article","div","image","imageUrlForRestaurants","name","address","more","href","urlForRestaurant","favoriteBtn","status","is_favorite","setFavoriteButton","favoriteRestaurant","target","classList","add","remove","className","indexOf","marker","mapMarkerForRestaurant","addListener","location","url","push"],"mappings":"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","file":"main.js","sourcesContent":["let restaurants, neighborhoods, cuisines, mainmap;\nvar markers = [];\n\n/**\n * Fetch neighborhoods and cuisines as soon as the page is loaded.\n */\ndocument.addEventListener('DOMContentLoaded', event => {\n  fetchNeighborhoods();\n  fetchCuisines();\n  updateRestaurants();\n  lazyload();\n\n  // Alternative to SW Background SYNC\n  // if (navigator.onLine) {\n  //   DBHelper.syncAllData();\n  // }\n  // window.addEventListener('online', function() {\n  //   DBHelper.syncAllData();\n  // });\n  // window.addEventListener('offline', function() {\n  //   console.info('It seems we are offline at the moment...');\n  // });\n});\n\n/**\n * Fetch all neighborhoods and set their HTML.\n */\nfetchNeighborhoods = () => {\n  DBHelper.fetchNeighborhoods((error, neighborhoods) => {\n    if (error) {\n      // Got an error\n      console.error(error);\n    } else {\n      self.neighborhoods = neighborhoods;\n      fillNeighborhoodsHTML();\n    }\n  });\n};\n\n/**\n * Set neighborhoods HTML.\n */\nfillNeighborhoodsHTML = (neighborhoods = self.neighborhoods) => {\n  const select = document.getElementById('neighborhoods-select');\n  neighborhoods.forEach(neighborhood => {\n    const option = document.createElement('option');\n    option.innerHTML = neighborhood;\n    option.value = neighborhood;\n    select.append(option);\n  });\n};\n\n/**\n * Fetch all cuisines and set their HTML.\n */\nfetchCuisines = () => {\n  DBHelper.fetchCuisines((error, cuisines) => {\n    if (error) {\n      // Got an error!\n      console.error(error);\n    } else {\n      self.cuisines = cuisines;\n      fillCuisinesHTML();\n    }\n  });\n};\n\n/**\n * Set cuisines HTML.\n */\nfillCuisinesHTML = (cuisines = self.cuisines) => {\n  const select = document.getElementById('cuisines-select');\n\n  cuisines.forEach(cuisine => {\n    const option = document.createElement('option');\n    option.innerHTML = cuisine;\n    option.value = cuisine;\n    select.append(option);\n  });\n};\n\n/**\n * Initialize Google map, called from HTML.\n */\nwindow.initMap = () => {\n  let loc = {\n    lat: 40.722216,\n    lng: -73.987501\n  };\n  self.mainmap = new google.maps.Map(document.getElementById('map'), {\n    zoom: 12,\n    center: loc,\n    scrollwheel: false\n  });\n  //updateRestaurants();\n  if (typeof google === 'object' && typeof google.maps === 'object')\n    addMarkersToMap();\n};\n\n/**\n * Add google map only on request of interactivity\n */\naddGmapMain = () => {\n  document\n    .getElementById('map-container')\n    .setAttribute('class', 'map--requested');\n  const script = document.createElement('script');\n  script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyBN-_N7NAK_k8QKsoHe6pd4M8aIhA1HX6E&libraries=places&callback=initMap`;\n  script.type = 'text/javascript';\n  document.body.appendChild(script);\n};\n\n/**\n * Update page and map for current restaurants.\n */\nupdateRestaurants = () => {\n  const cSelect = document.getElementById('cuisines-select');\n  const nSelect = document.getElementById('neighborhoods-select');\n\n  const cIndex = cSelect.selectedIndex;\n  const nIndex = nSelect.selectedIndex;\n\n  const cuisine = cSelect[cIndex].value;\n  const neighborhood = nSelect[nIndex].value;\n\n  DBHelper.fetchRestaurantByCuisineAndNeighborhood(\n    cuisine,\n    neighborhood,\n    (error, restaurants) => {\n      if (error) {\n        // Got an error!\n        console.error(error);\n      } else {\n        resetRestaurants(restaurants);\n        fillRestaurantsHTML();\n        lazyload();\n      }\n    }\n  );\n};\n\n/**\n * Clear current restaurants, their HTML and remove their map markers.\n */\nresetRestaurants = restaurants => {\n  // Remove all restaurants\n  self.restaurants = [];\n  const ul = document.getElementById('restaurants-list');\n  ul.innerHTML = '';\n\n  // Remove all map markers\n  self.markers.forEach(m => m.setMap(null));\n  self.markers = [];\n  self.restaurants = restaurants;\n};\n\n/**\n * Create all restaurants HTML and add them to the webpage.\n */\nfillRestaurantsHTML = (restaurants = self.restaurants) => {\n  const ul = document.getElementById('restaurants-list');\n  restaurants.forEach(restaurant => {\n    ul.append(createRestaurantHTML(restaurant));\n  });\n  if (typeof google === 'object' && typeof google.maps === 'object')\n    addMarkersToMap();\n};\n\n/**\n * Create restaurant HTML.\n */\ncreateRestaurantHTML = restaurant => {\n  const li = document.createElement('li');\n  const article = document.createElement('article');\n  article.setAttribute('role', 'article');\n  const div = document.createElement('div');\n  div.setAttribute('class', 'rest-info');\n\n  const image = DBHelper.imageUrlForRestaurants(restaurant);\n  article.append(image);\n\n  const name = document.createElement('h2');\n  name.innerHTML = restaurant.name;\n  div.append(name);\n\n  const neighborhood = document.createElement('p');\n  neighborhood.innerHTML = restaurant.neighborhood;\n  neighborhood.setAttribute('class', 'neighborhood');\n  div.append(neighborhood);\n\n  const address = document.createElement('p');\n  address.innerHTML = restaurant.address;\n  address.setAttribute('class', 'address');\n  div.append(address);\n\n  const more = document.createElement('a');\n  more.innerHTML = 'View Details';\n  more.setAttribute(\n    'aria-label',\n    'View Details for ' + restaurant.name + ' restaurant'\n  );\n  more.href = DBHelper.urlForRestaurant(restaurant);\n  div.append(more);\n\n  const favoriteBtn = document.createElement('button');\n  favoriteBtn.setAttribute('class', 'favorite-button');\n  const status = restaurant.is_favorite == 'true' ? 'true' : 'false';\n  setFavoriteButton(favoriteBtn, status, restaurant);\n  // if (status === 'false')\n  //   favoriteBtn.setAttribute(\n  //     'arial-label',\n  //     `Add ${restaurant.name} to your favorite list.`\n  //   );\n  favoriteBtn.addEventListener('click', event => {\n    favoriteRestaurant(event.target, restaurant);\n  });\n  div.append(favoriteBtn);\n\n  article.append(div);\n  li.append(article);\n\n  return li;\n};\n\n/*\n * Set status (text and class) for favorite button\n */\nsetFavoriteButton = (target, status, restaurant) => {\n  if (status === 'true') {\n    target.classList.add('is-favorite');\n    target.innerHTML = '&#9733; Favorite';\n    target.setAttribute(\n      'arial-label',\n      `${\n        restaurant.name\n      } is one of your favorite restaurants. Click to remove it from your favorites' list`\n    );\n  } else {\n    target.classList.remove('is-favorite');\n    target.innerHTML = '&#9734; Add to favorite';\n    target.setAttribute(\n      'arial-label',\n      `Add ${restaurant.name} to your favorite list.`\n    );\n  }\n};\n\n/*\n * Restaurant function add-to or remove-from favorites\n */\nfavoriteRestaurant = (target, restaurant) => {\n  if (target.className.indexOf('is-favorite') > -1) {\n    setFavoriteButton(target, 'false');\n    DBHelper.favoriteRestaurant(restaurant, 'false');\n  } else {\n    setFavoriteButton(target, 'true');\n    DBHelper.favoriteRestaurant(restaurant, 'true');\n  }\n};\n\n/**\n * Add markers for current restaurants to the map.\n */\naddMarkersToMap = (restaurants = self.restaurants) => {\n  if (restaurants)\n    // Added because sometimes gmap is faster than resta server\n    restaurants.forEach(restaurant => {\n      // Add marker to the map\n      const marker = DBHelper.mapMarkerForRestaurant(restaurant, self.mainmap);\n      google.maps.event.addListener(marker, 'click', () => {\n        window.location.href = marker.url;\n      });\n      if (self.markers) self.markers.push(marker);\n    });\n};\n"]}
let restaurant,map;document.addEventListener("DOMContentLoaded",e=>{if(fetchRestaurantFromURL((e,t)=>{e&&console.error(e)}),document.getElementById("show-map").addEventListener("click",addGmapDetail,!0),document.getElementById("new-review-form").addEventListener("submit",submitReview),window.innerWidth>=992){const e=document.getElementById("show-map");window.setTimeout(e.click(),250)}}),window.initDetailMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),"object"==typeof google&&"object"==typeof google.maps&&DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),addGmapDetail=(()=>{document.getElementById("map-container").setAttribute("class","map--requested");const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBN-_N7NAK_k8QKsoHe6pd4M8aIhA1HX6E&libraries=places&callback=initDetailMap",e.type="text/javascript",document.body.appendChild(e)}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,r)=>{if(self.restaurant=r,r)document.title=`${r.name} -  Info & Details`,document.querySelector('meta[name="description"]').setAttribute("content",`Information about ${r.name}: location, opnening hours and latest reviews`),fillBreadcrumb(),fillRestaurantHTML(),lazyload(),e(null,r);else{console.error(t);const e=document.getElementById("new-review");e.parentNode.removeChild(e)}}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("favorite-button");"true"==e.is_favorite?setFavoriteButton(t,"true",e):t.setAttribute("arial-label",`Add ${e.name} to your favorite list.`),t.addEventListener("click",t=>{favoriteRestaurant(t.target,e)});const r=document.getElementById("restaurant-address");r.innerHTML=e.address,r.setAttribute("tabindex","0");const n=document.getElementById("restaurant-img"),a=DBHelper.imageUrlForRestaurant(e);n.append(a),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fetchReviews()}),setFavoriteButton=((e,t,r)=>{"true"===t?(e.classList.add("is-favorite"),e.innerHTML="&#9733; Favorite",e.setAttribute("arial-label",`${r.name} is one of your favorite restaurants. Click to remove it from your favorites' list`)):(e.classList.remove("is-favorite"),e.innerHTML="&#9734; Add to favorite",e.setAttribute("arial-label",`Add ${r.name} to your favorite list.`))}),favoriteRestaurant=((e,t)=>{e.className.indexOf("is-favorite")>-1?(setFavoriteButton(e,"false",t),DBHelper.favoriteRestaurant(t,"false")):(setFavoriteButton(e,"true",t),DBHelper.favoriteRestaurant(t,"true"))}),fetchReviews=(e=>{const t=getParameterByName("id");t?DBHelper.fetchReviewsByRestaurantId(t,(e,t)=>{if(self.restaurant.reviews=t,!t)return console.error(e),void fillErrorReviewsHTML();fillReviewsHTML()}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours"),r=document.createElement("tr"),n=document.createElement("th"),a=document.createElement("th");n.setAttribute("scope","col"),n.setAttribute("tabindex","0"),n.innerHTML="Day",r.appendChild(n),a.setAttribute("scope","col"),a.setAttribute("tabindex","0"),a.innerHTML="Opening hours",r.appendChild(a),t.appendChild(r);for(let r in e){const n=document.createElement("tr"),a=document.createElement("td"),i=document.createElement("td");a.innerHTML=r,a.setAttribute("tabindex","0"),n.appendChild(a),i.innerHTML=e[r],i.setAttribute("tabindex","0"),n.appendChild(i),t.appendChild(n)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),r=document.createElement("h3");if(r.innerHTML="Reviews",r.setAttribute("id","reviews-title"),t.appendChild(r),!e){const e=document.createElement("p");return e.setAttribute("class","review--notfound"),e.innerHTML="No reviews yet!",void t.appendChild(e)}e.sort(function(e,t){return e.createdAt<t.createdAt?1:e.createdAt>t.createdAt?-1:0});const n=document.getElementById("reviews-list");e.forEach(e=>{n.appendChild(createReviewHTML(e))}),t.appendChild(n)}),fillErrorReviewsHTML=(()=>{const e=document.getElementById("reviews-container"),t=document.createElement("h3");t.innerHTML="Reviews",t.setAttribute("id","reviews-title"),e.appendChild(t);const r=document.createElement("p");r.setAttribute("class","review--notfound"),r.innerHTML="There are no older reviews to show: try again when online",e.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),r=document.createElement("article");r.setAttribute("tabindex","0"),r.setAttribute("role","article"),r.setAttribute("arial-label","Review.");const n=document.createElement("div"),a=document.createElement("p");a.innerHTML=new Date(e.createdAt).toDateString(),a.setAttribute("aria-label",`Date: ${e.date}.`),a.setAttribute("class","review--date"),n.appendChild(a);const i=document.createElement("p");i.innerHTML=e.name,i.setAttribute("class","review--author"),i.setAttribute("aria-label",`Author: ${e.name}.`),n.appendChild(i),n.setAttribute("class","review--head"),r.appendChild(n);const s=document.createElement("p");let l='<span class="review--ratingTitle" arial-hidden="true">Rating</span> <span class="review--ratingStars" arial-hidden="true">';for(let t=0,r=e.rating;t<r;t++)l+='<span class="full">&#9733;</span>';if(e.rating<5)for(let t=0,r=5-e.rating;t<r;t++)l+='<span class="empty"></span>';l+="</span>",s.innerHTML=l,s.setAttribute("aria-label",`Rating: ${e.rating} out of 5.`),s.setAttribute("class","review--rating"),r.appendChild(s);const o=document.createElement("p");return o.innerHTML=e.comments,o.setAttribute("class","review--comment"),r.appendChild(o),t.appendChild(r),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb").getElementsByTagName("ol")[0],r=document.createElement("li"),n=document.createElement("a");n.innerHTML=e.name,n.setAttribute("aria-current","page"),r.appendChild(n),t.appendChild(r)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}),escapeRegExp=(e=>e.replace(/[*+^${}()<>|[\]\\]/g," ")),submitReview=(e=>{let t,r,n=document.getElementById("new-review--submit"),a=document.getElementById("new-review--name"),i=document.getElementById("new-review--comment"),s=document.getElementById("new-review--rating"),l=s.value,o=document.getElementById("new-review--msg"),d=document.getElementById("reviews-list"),u="";e.preventDefault(),resetMessage(o),n.disabled=!0,a.value||(u+=(u?"<br/>":"<ul>")+"<li>Your name couldn&apos;t be empty</li>"),a.value.length<2&&(u+=(u?"<br/>":"<ul>")+"<li>Your name is too short (please provide at least 3 characters)</li>"),i.value||(u+=(u?"<br/>":"<ul>")+"<li>Your review couldn&apos;t be empty</li>"),i.value.length<100&&(u+=(u?"<br/>":"<ul>")+"<li>Your review is too short <em>(at least 100 characters comment is requested)</em></li>"),"none"===l&&(u+=(u?"<br/>":"<ul>")+"<li>Rating is not set</li>"),u?(u+="</ul>",o.innerHTML=u,o.setAttribute("class","error"),o.style.display="block",n.disabled=!1):(t={restaurant_id:self.restaurant.id,name:escapeRegExp(a.value),rating:parseInt(l),comments:escapeRegExp(i.value)},DBHelper.saveReview(t).then(e=>{r=createReviewHTML(e),a.value="",i.value="",s.selectedIndex=0,setTimeout(e=>{r.setAttribute("class","added"),d.firstChild?d.insertBefore(r,d.firstChild):d.appendChild(r),o.setAttribute("class","success"),o.innerHTML="<p>Thank you for sending your review!</p>",o.style.display="block",n.disabled=!1,smoothScrollTo("reviews-container",650,100),r.firstChild.focus()},250),setTimeout(e=>{resetMessage(o),r.setAttribute("class",""),n.disabled=!1},7500)}))}),resetMessage=(e=>{e.style.display="none",e.classList.remove("success","error"),e.innerHTML=""}),easeInOutQuart=((e,t,r,n)=>(e/=n/2)<1?r/2*e*e*e*e+t:-r/2*((e-=2)*e*e*e-2)+t),window.smoothScrollTo=((e,t=400,r=0)=>{let n=window.scrollY||window.pageYOffset,a=document.getElementById(e),i=a.offsetTop-a.scrollTop+a.clientTop-r;distanceY=i-n,startTime=(new Date).getTime();let s=window.setInterval(function(){let e=(new Date).getTime()-startTime,r=easeInOutQuart(e,n,distanceY,t);e>=t&&window.clearInterval(s),window.scrollTo(0,r)},1e3/60)});
//# sourceMappingURL=restaurant_info.js.map

let restaurant,map;document.addEventListener("DOMContentLoaded",e=>{if(fetchRestaurantFromURL((e,t)=>{e&&console.error(e)}),document.getElementById("show-map").addEventListener("click",addGmapDetail,!0),document.getElementById("new-review-form").addEventListener("submit",submitReview),window.innerWidth>=992){const e=document.getElementById("show-map");window.setTimeout(e.click(),250)}}),window.initDetailMap=(()=>{self.restaurant&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),"object"==typeof google&&"object"==typeof google.maps&&DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))}),addGmapDetail=(()=>{document.getElementById("map-container").setAttribute("class","map--requested");const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBN-_N7NAK_k8QKsoHe6pd4M8aIhA1HX6E&libraries=places&callback=initDetailMap",e.type="text/javascript",document.body.appendChild(e)}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{if(self.restaurant=n,n)document.title=`${n.name} -  Info & Details`,document.querySelector('meta[name="description"]').setAttribute("content",`Information about ${n.name}: location, opnening hours and latest reviews`),fillBreadcrumb(),fillRestaurantHTML(),lazyload(),e(null,n);else{console.error(t);const e=document.getElementById("new-review");e.parentNode.removeChild(e)}}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("favorite-button");"true"==e.is_favorite&&setFavoriteButton(t,"true"),t.addEventListener("click",t=>{favoriteRestaurant(t.target,e)});const n=document.getElementById("restaurant-address");n.innerHTML=e.address,n.setAttribute("tabindex","0");const r=document.getElementById("restaurant-img"),a=DBHelper.imageUrlForRestaurant(e);r.append(a),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fetchReviews()}),setFavoriteButton=((e,t)=>{"true"===t?(e.classList.add("is-favorite"),e.innerHTML="&#9733; Favorite"):(e.classList.remove("is-favorite"),e.innerHTML="&#9734; Add to favorite")}),favoriteRestaurant=((e,t)=>{e.className.indexOf("is-favorite")>-1?(setFavoriteButton(e,"false"),DBHelper.favoriteRestaurant(t,"false")):(setFavoriteButton(e,"true"),DBHelper.favoriteRestaurant(t,"true"))}),fetchReviews=(e=>{const t=getParameterByName("id");t?DBHelper.fetchReviewsByRestaurantId(t,(e,t)=>{if(self.restaurant.reviews=t,!t)return console.error(e),void fillErrorReviewsHTML();fillReviewsHTML()}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours"),n=document.createElement("tr"),r=document.createElement("th"),a=document.createElement("th");r.setAttribute("scope","col"),r.setAttribute("tabindex","0"),r.innerHTML="Day",n.appendChild(r),a.setAttribute("scope","col"),a.setAttribute("tabindex","0"),a.innerHTML="Opening hours",n.appendChild(a),t.appendChild(n);for(let n in e){const r=document.createElement("tr"),a=document.createElement("td"),i=document.createElement("td");a.innerHTML=n,a.setAttribute("tabindex","0"),r.appendChild(a),i.innerHTML=e[n],i.setAttribute("tabindex","0"),r.appendChild(i),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",n.setAttribute("id","reviews-title"),t.appendChild(n),!e){const e=document.createElement("p");return e.setAttribute("class","review--notfound"),e.innerHTML="No reviews yet!",void t.appendChild(e)}e.sort(function(e,t){return e.createdAt<t.createdAt?1:e.createdAt>t.createdAt?-1:0});const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),fillErrorReviewsHTML=(()=>{const e=document.getElementById("reviews-container"),t=document.createElement("h2");t.innerHTML="Reviews",t.setAttribute("id","reviews-title"),e.appendChild(t);const n=document.createElement("p");n.setAttribute("class","review--notfound"),n.innerHTML="There are no older reviews to show: try again when online",e.appendChild(n)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("article");n.setAttribute("tabindex","0"),n.setAttribute("role","article"),n.setAttribute("arial-label","Review.");const r=document.createElement("div"),a=document.createElement("p");a.innerHTML=new Date(e.createdAt).toDateString(),a.setAttribute("aria-label",`Date: ${e.date}.`),a.setAttribute("class","review--date"),r.appendChild(a);const i=document.createElement("p");i.innerHTML=e.name,i.setAttribute("class","review--author"),i.setAttribute("aria-label",`Author: ${e.name}.`),r.appendChild(i),r.setAttribute("class","review--head"),n.appendChild(r);const s=document.createElement("p");let l='<span class="review--ratingTitle" arial-hidden="true">Rating</span> <span class="review--ratingStars" arial-hidden="true">';for(let t=0,n=e.rating;t<n;t++)l+='<span class="full">&#9733;</span>';if(e.rating<5)for(let t=0,n=5-e.rating;t<n;t++)l+='<span class="empty"></span>';l+="</span>",s.innerHTML=l,s.setAttribute("aria-label",`Rating: ${e.rating} out of 5.`),s.setAttribute("class","review--rating"),n.appendChild(s);const o=document.createElement("p");return o.innerHTML=e.comments,o.setAttribute("class","review--comment"),n.appendChild(o),t.appendChild(n),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb").getElementsByTagName("ol")[0],n=document.createElement("li"),r=document.createElement("a");r.innerHTML=e.name,r.setAttribute("aria-current","page"),n.appendChild(r),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),escapeRegExp=(e=>e.replace(/[*+^${}()<>|[\]\\]/g," ")),submitReview=(e=>{let t,n,r=document.getElementById("new-review--submit"),a=document.getElementById("new-review--name"),i=document.getElementById("new-review--comment"),s=document.getElementById("new-review--rating"),l=s.value,o=document.getElementById("new-review--msg"),d=document.getElementById("reviews-list"),c="";e.preventDefault(),resetMessage(o),r.disabled=!0,a.value||(c+=(c?"<br/>":"<ul>")+"<li>Your name couldn&apos;t be empty</li>"),a.value.length<2&&(c+=(c?"<br/>":"<ul>")+"<li>Your name is too short (please provide at least 3 characters)</li>"),i.value||(c+=(c?"<br/>":"<ul>")+"<li>Your review couldn&apos;t be empty</li>"),i.value.length<100&&(c+=(c?"<br/>":"<ul>")+"<li>Your review is too short <em>(at least 100 characters comment is requested)</em></li>"),"none"===l&&(c+=(c?"<br/>":"<ul>")+"<li>Rating is not set</li>"),c?(c+="</ul>",o.innerHTML=c,o.setAttribute("class","error"),o.style.display="block",r.disabled=!1):(t={restaurant_id:self.restaurant.id,name:escapeRegExp(a.value),rating:parseInt(l),comments:escapeRegExp(i.value)},DBHelper.saveReview(t).then(e=>{n=createReviewHTML(e),a.value="",i.value="",s.selectedIndex=0,setTimeout(e=>{n.setAttribute("class","added"),d.firstChild?d.insertBefore(n,d.firstChild):d.appendChild(n),o.setAttribute("class","success"),o.innerHTML="<p>Thank you for sending your review!</p>",o.style.display="block",r.disabled=!1,smoothScrollTo("reviews-container",650,100),n.firstChild.focus()},250),setTimeout(e=>{resetMessage(o),n.setAttribute("class",""),r.disabled=!1},7500)}))}),resetMessage=(e=>{e.style.display="none",e.classList.remove("success","error"),e.innerHTML=""}),easeInOutQuart=((e,t,n,r)=>(e/=r/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t),window.smoothScrollTo=((e,t=400,n=0)=>{let r=window.scrollY||window.pageYOffset,a=document.getElementById(e),i=a.offsetTop-a.scrollTop+a.clientTop-n;distanceY=i-r,startTime=(new Date).getTime();let s=window.setInterval(function(){let e=(new Date).getTime()-startTime,n=easeInOutQuart(e,r,distanceY,t);e>=t&&window.clearInterval(s),window.scrollTo(0,n)},1e3/60)});
//# sourceMappingURL=restaurant_info.js.map
